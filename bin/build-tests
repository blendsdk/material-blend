#!/bin/bash

DIRNAME="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
BUILD_DIR=$DIRNAME/../build
TESTS_DIR=$DIRNAME/../tests
TEST_RUNNER_DIR=$TESTS_DIR/testrunner

$DIRNAME/build-blend

rm -fR $TESTS_DIR/blend
ln -s $BUILD_DIR/blend $TESTS_DIR

#echo "Preparing the TestRunner"

rm -fR $TEST_RUNNER_DIR/js
rm -fR $TEST_RUNNER_DIR/blend
rm -fR $TEST_RUNNER_DIR/css

rm -fR $TEST_RUNNER_DIR/sources
mkdir -p $TEST_RUNNER_DIR/sources

ln -s $BUILD_DIR/blend $TEST_RUNNER_DIR
ln -s $BUILD_DIR/css $TEST_RUNNER_DIR
ln -s $DIRNAME/../blend/src $TEST_RUNNER_DIR/sources/blend
ln -s $TESTS_DIR/testapp $TEST_RUNNER_DIR/sources/testapp
ln -s $TESTS_DIR/tests $TEST_RUNNER_DIR/sources/tests
ln -s $TESTS_DIR/experiments $TEST_RUNNER_DIR/sources/experiments

echo "Building Tests";
cd $TESTS_DIR
tsc